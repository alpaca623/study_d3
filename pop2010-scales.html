<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pop2010-scales</title>
    <style>
      body {
        font-family: Helvetica;
      }
      svg {
        width: 500px;
        height: 500px;
      }
      .top-label {
        font-size: 13px;
        font-style: italic;
        text-transform: uppercase;
        float: left;
      }
      .age-label {
        text-align: right;
        font-weight: bold;
        width: 90px;
        padding-right: 10px;
      }
      .clearfix {
        clear: both;
      }
      .bar {
        fill: darkslateblue;
      }
      .bar-label {
        text-anchor: end;
      }
      .axis line {
        fill: none;
        stroke: #000;
      }
      .axis path {
        display: none;
      }
      .axis text {
        font-size: 13px;
      }
    </style>
  </head>
  <body>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script>
      const body = d3.select("body");
      body.append("h2").text("Age distribution of the world, 2010");
      body
        .append("div")
        .attr("class", "top-label age-label")
        .append("p")
        .text("age group");
      body
        .append("div")
        .attr("class", "top-label")
        .append("p")
        .text("portion of the population");
      body.append("div").attr("class", "clearfix");

      const popData = [
        { age: "80 and up", value: 0.016, position: 0 },
        { age: "75 - 79", value: 0.015, position: 1 },
        { age: "70 - 74", value: 0.021, position: 2 },
        { age: "69 - 65", value: 0.026, position: 3 },
        { age: "60 - 64", value: 0.034, position: 4 },
        { age: "59 - 55", value: 0.045, position: 5 },
        { age: "50 - 54", value: 0.051, position: 6 },
        { age: "49 - 45", value: 0.060, position: 7 },
        { age: "40 - 44", value: 0.066, position: 8 },
        { age: "39 - 35", value: 0.071, position: 9 },
        { age: "34 - 30", value: 0.073, position: 10 },
        { age: "29 - 25", value: 0.081, position: 11 },
        { age: "24 - 20", value: 0.089, position: 12 },
        { age: "19 - 15", value: 0.088, position: 13 },
        { age: "10 - 14", value: 0.086, position: 14 },
        { age: "5 - 9", value: 0.088, position: 15 },
        { age: "0 - 4", value: 0.093, position: 16 }
      ];
      const margin = { top: 30, right: 0, bottom: 0, left: 100 };
      const width = 500 - margin.left - margin.right;
      const height = 450 - margin.top - margin.bottom;

      const svg = body
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", `translate(${margin.left}, ${margin.top})`);

      // x 변수로 인해 폐지
      // const scaleFactor = width / d3.max(popData, o => o.value); // (가로길이를 배열의 최대값(그래프의 최대값)으로 나눠 비율을 구한다)
      // console.log(scaleFactor);

      // margin 변수 추가로 인한 폐지
      // const leftMargin = 100; // 왼쪽 여백 주기(그래프 본체의 기준을 잡아줌)
      // const topMargin = 30; // 위에 여백 주기(그래프 본체의 기준을 잡아줌)
      // const translate = `translate(${leftMargin},${topMargin})`;

      // x 변수로 인해 폐지
      // const scale = `scale(${scaleFactor}, 1)`; // 그래프의 비율을 잡아줌(현재는 datas 배열의 가장 최고값인 9.3을 100으로 잡는다)
      const barHeight = 20; // 막대의 높이
      const barGap = 5; // 막대 사이의 간격
      const barSpacing = barHeight + barGap; // 막대의 y좌표를 잡아준다.

      const tickGap = 5; // x축 범례..(?)의 위치를 잡기 위한 변수
      const tickHeight = 10;

      const x = d3.scale
        .linear()
        .domain([0, d3.max(popData, o => o.value)])
        .range([0, width]);

      const barGroup = svg.append("g").attr("class", "bar");

      const barLabelGroup = svg.append("g").attr("class", "bar-label");

      var xAxis = d3.svg
        .axis()
        .scale(x)
        .orient("top")
        .ticks(5, '%');

      barGroup
        .selectAll("rect")
        .data(popData)
        .enter()
        .append("rect")
        .attr("x", 0)
        .attr("width", d => x(d.value))
        .attr("y", d => d.position * barSpacing)
        .attr("height", barHeight)

      barLabelGroup
        .selectAll("rect")
        .data(popData)
        .enter()
        .append("text")
        .attr("y", d => d.position * barSpacing + barHeight * (2 / 3))
        .attr("x", -10)
        .text(d => d.age);

      svg.append('g').call(xAxis).attr("class", "x axis");
    </script>
  </body>
</html>
